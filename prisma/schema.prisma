// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

model User {
    id               String             @id @default(uuid())
    email            String             @unique @db.VarChar(100)
    password         String             @db.VarChar(100)
    role             RoleEnum           @default(VOLUNTEER)
    lastConnexion    DateTime           @default(now())
    refreshToken     String?            @db.VarChar(255) //  @db.Text
    status           UserStatusEnum     @default(ACTIVE)
    createdAt        DateTime           @default(now())
    updatedAt        DateTime           @updatedAt
    userTaskEvent    UserTaskEvent[]
    userNotification UserNotification[]
    userBadge        UserBadge[]
    profile          Profile?
}

model Profile {
    userId     String   @id @unique
    firstname  String   @db.VarChar(50)
    lastname   String   @db.VarChar(50)
    nickname   String   @db.VarChar(20)
    avatarPath String?  @db.VarChar(255)
    createdAt  DateTime @default(now())
    updatedAt  DateTime @updatedAt
    user       User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model Task {
    id             Int             @id @default(autoincrement())
    name           String          @unique @db.VarChar(30)
    description    String          @db.Text()
    skillName      String?         @db.VarChar(30)
    skillBadgePath String?         @db.VarChar(255)
    createdAt      DateTime        @default(now())
    updatedAt      DateTime        @updatedAt
    taskEvent      TaskEvent[]
    userTaskEvent  UserTaskEvent[]
    userBadge      UserBadge[]
}

model Event {
    id            Int             @id @default(autoincrement())
    title         String          @db.VarChar(30)
    description   String          @db.Text()
    adress        String          @db.VarChar(100)
    startDate     DateTime        @db.DateTime
    endDate       DateTime        @db.DateTime
    status        EventStatusEnum @default(INCOMPLETE)
    createdAt     DateTime        @default(now())
    updatedAt     DateTime        @updatedAt
    taskEvent     TaskEvent[]
    userTaskEvent UserTaskEvent[]
}

model Notification {
    id               Int                @id @default(autoincrement())
    content          String             @db.VarChar(100)
    createdAt        DateTime           @default(now())
    updatedAt        DateTime           @updatedAt
    userNotification UserNotification[]
}

model TaskEvent {
    id              Int      @id @default(autoincrement())
    taskId          Int
    eventId         Int
    volunteerNumber Int      @default(1) @db.SmallInt()
    needValidation  Boolean  @default(false)
    createdAt       DateTime @default(now())
    updatedAt       DateTime @updatedAt
    task            Task     @relation(fields: [taskId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    event           Event    @relation(fields: [eventId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model UserTaskEvent {
    id        Int                     @id @default(autoincrement())
    userId    String
    taskId    Int
    eventId   Int
    status    UserTaskEventStatusEnum @default(VALIDATED)
    createdAt DateTime                @default(now())
    updatedAt DateTime                @updatedAt
    user      User                    @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    task      Task                    @relation(fields: [taskId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    event     Event                   @relation(fields: [eventId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model UserNotification {
    id             Int                        @id @default(autoincrement())
    userId         String
    notificationId Int
    status         UserNotificationStatusEnum @default(NOTREAD)
    createdAt      DateTime                   @default(now())
    updatedAt      DateTime                   @updatedAt
    user           User                       @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    notification   Notification               @relation(fields: [notificationId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model UserBadge {
    id     Int    @id @default(autoincrement())
    userId String
    taskId Int
    level  Int    @default(1) @db.TinyInt()
    user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    task   Task   @relation(fields: [taskId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

enum RoleEnum {
    VOLUNTEER
    ADMIN
    SUPERADMIN
}

enum EventStatusEnum {
    COMPLETE // CLOSED
    INCOMPLETE // OPEN
}

enum UserTaskEventStatusEnum {
    WAITING // PENDING
    VALIDATED // APPROVED 
    REFUSED // REJECTED
}

enum UserNotificationStatusEnum {
    READ 
    NOTREAD // UNREAD
}

enum UserStatusEnum {
    INACTIVE
    ACTIVE
    BANNED
}
